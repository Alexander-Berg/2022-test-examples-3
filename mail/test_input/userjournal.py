# Test case for maillog.
header = {
    'path': '/var/log/mops/user_journal.tskv',
    'ident': 'userjournal',
    'offset': '3',
    'partition': '0',
    'seqno': '9921',
    'server': 'logship-dev01e.cmail.yandex.net',
    'sourceid': 'base64:eL5wm2zzRya7j7ZHsKS2Zg',
    'topic': 'rt3.sas--userjournal--raw',
}

data = """tskv	tableName=users_history	uid=00000000000062659260	date=1433170679262	ip=188.162.65.37	target=settings	operation=settings_update	state=disallowThemes=	affected=0	hidden=1	regionId=0	suid=171638083	mdb=mdb290	
tskv	tableName=users_history	uid=00000000000289952877	date=1433170679263	ip=90.150.155.251	target=settings	operation=settings_update	state=promo-manager=%7B%22last-time-show-promo%22%3A1433170679092%2C%22last-promo-was-name%22%3A%22starwars%22%7D	affected=0	hidden=1	regionId=0	suid=833449679	mdb=mdb310	test=	
tskv	tableName=users_history	uid=00000000000217921604	date=1433103508192	ip=127.0.0.1	module=fastsrv	target=message	operation=receive	state=fid=2420001020004055735,ftype=4,from=militari.s@mail.ru,mid=2420000006590597452	affected=1	hidden=0	regionId=0	suid=678290440	mdb=mdb230
tskv	tableName=users_history	uid=00000000000035123203	date=1433171229968	ip=94.100.178.147	module=yserver_imap	target=account	operation=authorizationaffected=0	hidden=0	regionId=0	suid=88668353	mdb=mdb290	
tskv	tableName=users_history	uid=00000000000309564445	date=1433171229968	ip=37.140.138.216	module=yserver_imap	target=account	operation=authorizationaffected=0	hidden=0	regionId=0	suid=851996995	mdb=mdb22	
tskv	tableName=users_history	uid=00000000000239242366	date=1433171230001	ip=94.100.185.209	module=yserver_imap	target=account	operation=authorizationaffected=0	hidden=0	regionId=0	suid=744784920	mdb=mdb290	
"""

expected = {'users_history': [['00000000000062659260_18446742640538610616',
                               {'cf:affected': '0',
                                'cf:date': '1433170679262',
                                'cf:hidden': '1',
                                'cf:ip': '188.162.65.37',
                                'cf:mdb': 'mdb290',
                                'cf:operation': 'settings_update',
                                'cf:regionId': '0',
                                'cf:state': 'disallowThemes=',
                                'cf:suid': '171638083',
                                'cf:tableName': 'users_history',
                                'cf:target': 'settings',
                                'cf:uid': '00000000000062659260'}],
                              ['00000000000289952877_18446742640538609616',
                               {'cf:affected': '0',
                                'cf:date': '1433170679263',
                                'cf:hidden': '1',
                                'cf:ip': '90.150.155.251',
                                'cf:mdb': 'mdb310',
                                'cf:operation': 'settings_update',
                                'cf:regionId': '0',
                                'cf:state': 'promo-manager=%7B%22last-time-show-promo%22%3A1433170679092%2C%22last-promo-was-name%22%3A%22starwars%22%7D',
                                'cf:suid': '833449679',
                                'cf:tableName': 'users_history',
                                'cf:target': 'settings',
                                'cf:test': '',
                                'cf:uid': '00000000000289952877'}],
                              ['00000000000217921604_18446742640605851616',
                               {'cf:affected': '1',
                                'cf:date': '1433103508192',
                                'cf:hidden': '0',
                                'cf:ip': '127.0.0.1',
                                'cf:mdb': 'mdb230',
                                'cf:module': 'fastsrv',
                                'cf:operation': 'receive',
                                'cf:regionId': '0',
                                'cf:state': 'fid=2420001020004055735,ftype=4,from=militari.s@mail.ru,mid=2420000006590597452',
                                'cf:suid': '678290440',
                                'cf:tableName': 'users_history',
                                'cf:target': 'message',
                                'cf:uid': '00000000000217921604'}],
                              ['00000000000035123203_18446742640537354616',
                               {'cf:date': '1433171229968',
                                'cf:hidden': '0',
                                'cf:ip': '94.100.178.147',
                                'cf:mdb': 'mdb290',
                                'cf:module': 'yserver_imap',
                                'cf:operation': 'authorizationaffected=0',
                                'cf:regionId': '0',
                                'cf:suid': '88668353',
                                'cf:tableName': 'users_history',
                                'cf:target': 'account',
                                'cf:uid': '00000000000035123203'}],
                              ['00000000000309564445_18446742640537354616',
                               {'cf:date': '1433171229968',
                                'cf:hidden': '0',
                                'cf:ip': '37.140.138.216',
                                'cf:mdb': 'mdb22',
                                'cf:module': 'yserver_imap',
                                'cf:operation': 'authorizationaffected=0',
                                'cf:regionId': '0',
                                'cf:suid': '851996995',
                                'cf:tableName': 'users_history',
                                'cf:target': 'account',
                                'cf:uid': '00000000000309564445'}],
                              ['00000000000239242366_18446742640538320616',
                               {'cf:date': '1433171230001',
                                'cf:hidden': '0',
                                'cf:ip': '94.100.185.209',
                                'cf:mdb': 'mdb290',
                                'cf:module': 'yserver_imap',
                                'cf:operation': 'authorizationaffected=0',
                                'cf:regionId': '0',
                                'cf:suid': '744784920',
                                'cf:tableName': 'users_history',
                                'cf:target': 'account',
                                'cf:uid': '00000000000239242366'}]]}
