// <<< AUTOGENERATED BY YANDEX.SCRIPT FROM event-logs/cross-platform-logs-parser.ts >>>

package com.yandex.xplat.testopithecus.common

import com.yandex.xplat.common.JSONSerializer
import com.yandex.xplat.common.MapJSONItem
import com.yandex.xplat.common.StringJSONItem
import com.yandex.xplat.eventus.common.EventusConstants
import com.yandex.xplat.eventus.common.EventusEvent

public open class CrossPlatformLogsParser(private var jsonSerializer: JSONSerializer) {
    open fun parse(line: String): EventusEvent {
        val json = this.jsonSerializer.deserialize(line).getValue() as MapJSONItem
        val value = requireNonNull(json.getMap("value"), "Нет аттрибутов у эвента!")
        val eventusName = (requireNonNull(value.`get`("event_name"), "Имя евента должно быть в аттрибутах") as StringJSONItem).value
        val loggingName = requireNonNull(json.getString("name"), "Имя эвента должно быть в имени эвента")
        if (loggingName != "${EventusConstants.PREFIX}${eventusName}") {
            throw Error("Плохое имя")
        }
        return EventusEvent.fromMap(eventusName, value)
    }

}

