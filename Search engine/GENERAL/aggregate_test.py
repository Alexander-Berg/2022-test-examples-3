RAW_DATA = [{"dictName1": {"updateDate": 1350000000, "generateDate": 1340000000,
                           "statistic": [{"time": 1350000001, "freshCnt": 2, "totalCnt": 12},
                                         {"time": 1350000062, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000123, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000184, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350000245, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000306, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000367, "freshCnt": 8, "totalCnt": 18},
                                         {"time": 1350000428, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000489, "freshCnt": 1, "totalCnt": 11},
                                         {"time": 1350000550, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350000611, "freshCnt": 5, "totalCnt": 15},
                                         {"time": 1350000672, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000733, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000794, "freshCnt": 8, "totalCnt": 18},
                                         {"time": 1350000855, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000916, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000977, "freshCnt": 2, "totalCnt": 12},
                                         {"time": 1350001038, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350001099, "freshCnt": 9, "totalCnt": 19},
                                         {"time": 1350001160, "freshCnt": 0, "totalCnt": 10},
                                         {"time": 1350001221, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350001282, "freshCnt": 1, "totalCnt": 11}]},
             "dictName2": {"updateDate": 1350000000, "generateDate": 1340000000,
                           "statistic": [{"time": 1350000011, "freshCnt": 2, "totalCnt": 12},
                                         {"time": 1350000072, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000133, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000194, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350000255, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000316, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000377, "freshCnt": 8, "totalCnt": 18},
                                         {"time": 1350000438, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000499, "freshCnt": 1, "totalCnt": 11},
                                         {"time": 1350000560, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350000621, "freshCnt": 5, "totalCnt": 15},
                                         {"time": 1350000682, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000720, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000780, "freshCnt": 8, "totalCnt": 18},
                                         {"time": 1350000845, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000906, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000967, "freshCnt": 2, "totalCnt": 12},
                                         {"time": 1350001028, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350001089, "freshCnt": 9, "totalCnt": 19},
                                         {"time": 1350001150, "freshCnt": 0, "totalCnt": 10},
                                         {"time": 1350001211, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350001272, "freshCnt": 1, "totalCnt": 11}]}, },
            {"dictName1": {"updateDate": 1350000000, "generateDate": 1340000000,
                           "statistic": [{"time": 1350000015, "freshCnt": 2, "totalCnt": 12},
                                         {"time": 1350000073, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000138, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000193, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350000259, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000312, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000374, "freshCnt": 8, "totalCnt": 18},
                                         {"time": 1350000436, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000498, "freshCnt": 1, "totalCnt": 11},
                                         {"time": 1350000564, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350000623, "freshCnt": 5, "totalCnt": 15},
                                         {"time": 1350000688, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000725, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000783, "freshCnt": 8, "totalCnt": 18},
                                         {"time": 1350000848, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000909, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000965, "freshCnt": 2, "totalCnt": 12},
                                         {"time": 1350001024, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350001082, "freshCnt": 9, "totalCnt": 19},
                                         {"time": 1350001151, "freshCnt": 0, "totalCnt": 10},
                                         {"time": 1350001211, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350001276, "freshCnt": 1, "totalCnt": 11}]},
             "dictName2": {"updateDate": 1350000000, "generateDate": 1340000000,
                           "statistic": [{"time": 1350000017, "freshCnt": 2, "totalCnt": 12},
                                         {"time": 1350000075, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000134, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000195, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350000252, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000311, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000370, "freshCnt": 8, "totalCnt": 18},
                                         {"time": 1350000436, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000493, "freshCnt": 1, "totalCnt": 11},
                                         {"time": 1350000566, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350000623, "freshCnt": 5, "totalCnt": 15},
                                         {"time": 1350000687, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000720, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000780, "freshCnt": 8, "totalCnt": 18},
                                         {"time": 1350000845, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000903, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000966, "freshCnt": 2, "totalCnt": 12},
                                         {"time": 1350001029, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350001084, "freshCnt": 9, "totalCnt": 19},
                                         {"time": 1350001154, "freshCnt": 0, "totalCnt": 10},
                                         {"time": 1350001212, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350001272, "freshCnt": 1, "totalCnt": 11}]}, },
            {"dictName1": {"updateDate": 1350000000, "generateDate": 1340000000,
                           "statistic": [{"time": 1350000017, "freshCnt": 2, "totalCnt": 12},
                                         {"time": 1350000075, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000133, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000199, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350000259, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000316, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000374, "freshCnt": 8, "totalCnt": 18},
                                         {"time": 1350000433, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000492, "freshCnt": 1, "totalCnt": 11},
                                         {"time": 1350000566, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350000623, "freshCnt": 5, "totalCnt": 15},
                                         {"time": 1350000686, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000723, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000782, "freshCnt": 8, "totalCnt": 18},
                                         {"time": 1350000847, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000906, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000962, "freshCnt": 2, "totalCnt": 12},
                                         {"time": 1350001028, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350001080, "freshCnt": 9, "totalCnt": 19},
                                         {"time": 1350001159, "freshCnt": 0, "totalCnt": 10},
                                         {"time": 1350001214, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350001273, "freshCnt": 1, "totalCnt": 11}]},
             "dictName2": {"updateDate": 1350000000, "generateDate": 1340000000,
                           "statistic": [{"time": 1350000018, "freshCnt": 2, "totalCnt": 12},
                                         {"time": 1350000078, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000135, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000193, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350000252, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000317, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000370, "freshCnt": 8, "totalCnt": 18},
                                         {"time": 1350000433, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000495, "freshCnt": 1, "totalCnt": 11},
                                         {"time": 1350000566, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350000629, "freshCnt": 5, "totalCnt": 15},
                                         {"time": 1350000684, "freshCnt": 6, "totalCnt": 16},
                                         {"time": 1350000724, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000782, "freshCnt": 8, "totalCnt": 18},
                                         {"time": 1350000845, "freshCnt": 4, "totalCnt": 14},
                                         {"time": 1350000908, "freshCnt": 7, "totalCnt": 17},
                                         {"time": 1350000967, "freshCnt": 2, "totalCnt": 12},
                                         {"time": 1350001025, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350001085, "freshCnt": 9, "totalCnt": 19},
                                         {"time": 1350001153, "freshCnt": 0, "totalCnt": 10},
                                         {"time": 1350001212, "freshCnt": 3, "totalCnt": 13},
                                         {"time": 1350001271, "freshCnt": 1, "totalCnt": 11}]}, }]
import unittest
from suggest_monitoring import data_processor

class AggregateTest(unittest.TestCase):
    def test_AggregateHostsData(self):
        result = data_processor.DataProcessor().aggregateHostsData(RAW_DATA)
        self.assertEqual(len(result["dictName1"]["statistic"]), 66)
        self.assertEqual(len(result["dictName2"]["statistic"]), 66)

    def test_NormalizeByTime(self):
        result = data_processor.DataProcessor().aggregateHostsData(RAW_DATA)
        result = data_processor.DataProcessor().normalizeByTime(result)
        row = filter(lambda x: x['time'] == 1350000000, result["dictName2"]["statistic"])
        self.assertTrue(len(row) > 0)
        self.assertEqual(row[0]['freshCnt'], 6)
        self.assertEqual(row[0]['totalCnt'], 36)

    def test_Aggregate(self):
        result = data_processor.DataProcessor().aggregate(RAW_DATA)
