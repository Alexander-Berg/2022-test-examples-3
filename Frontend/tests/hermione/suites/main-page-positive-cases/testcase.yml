feature: Кандидаты в меморандум

specs:
    beforeEach:
        - do: залогиниться в сервис под пользователем vh-selfservice-user5

    Положительные:
        1. Открытие главной страницы в сервисе Яндекс.Маяк:
            - do: открыть Яндекс.Маяк (/)
            - screenshot: логотип, выбранный таб "Кандидаты в меморандум", таб "Добавлены в меморандум", аккаунт пользователя, строка поиска, кнопка экспорта, таблица с данными, переключатель страниц [plain]

        2. Поиск по объекту:
            - do: ввести в строку поиска название объекта из столбца таблицы "Название"
            - do: подождать 2 секунды
            - assert: |
                  таблица обновилась
                  введённый в поисковую строку текст сохранился
                  в результатах поиска только те объекты, названия и ссылки которых удовлетворяют критериям поиска
            - do: кликнуть на значок крестика в поисковой строке
            - assert: |
                  текст из поисковой строки удалился, вместо него снова показан плейсхолдер "Поиск по объекту и ссылке"
                  таблица обновилась
                  показано больше данных, в том числе, не связанных с поисковым запросом

        3. Поиск по ссылке:
            - do: ввести в строку поиска ссылку из столбца таблицы "Найденная ссылка"
            - do: подождать 2 секунды
            - assert: |
                  таблица обновилась
                  введённый в поисковую строку текст сохранился
                  в результатах поиска только те объекты, названия и ссылки которых удовлетворяют критериям поиска
            - do: кликнуть на значок крестика в поисковой строке
            - assert: |
                  текст из поисковой строки удалился, вместо него снова показан плейсхолдер "Поиск по объекту и ссылке"
                  таблица обновилась
                  показано больше данных, в том числе, не связанных с поисковым запросом

        4. Экспорт файла в xls:
            - do: кликнуть на кнопку "Экспортировать файл"
            - assert: появился попап с двумя варинтами - xls и json
            - do: кликнуть на вариант xls
            - assert: |
                  открылась новая вкладка по адресу вида /api/mayak/export?fmt=xlsx&sort_by=crawl_date-&search=
                  вкладка закрылась
                  произошёл возврат на страницу с табом "Кандидаты в меморандум"
                  загрузился непустой файл в формате xls

        5. Экспорт файла в json:
            - do: кликнуть на кнопку "Экспортировать файл"
            - assert: появился попап с двумя варинтами - xls и json
            - do: кликнуть на вариант json
            - assert: |
                  открылась новая вкладка по адресу вида /api/mayak/export?fmt=json&sort_by=crawl_date-&search=
                  вкладка закрылась
                  произошёл возврат на страницу с табом "Кандидаты в меморандум"
                  загрузился непустой файл в формате json

        6. Вынесение и аннулирование вердикта:
            - do: найти в таблице объект, для которого в столбце "Вердикт" находится кнопка "Выбрать"
            - do: кликнуть на кнопку "Выбрать"
            - assert: появился попап с четырьмя варинтами - "Сбросить" (недоступен для клика), "Кандидат в меморандум", "Нерабочая ссылка", "Нерелевантная ссылка" (доступны для клика)
            - do: кликнуть по одному доступных для клика вариантов
            - assert: |
                  попап скрылся
                  кнопка в столбце "Вердикт" поменяла название с "Выбрать" на выбранный вариант
            - do: кликнуть на кнопку с выбранным вариантом в столбце "Вердикт"
            - assert: |
                  появился попап с четырьмя варинтами - "Сбросить", "Кандидат в меморандум", "Нерабочая ссылка", "Нерелевантная ссылка"
                  все варианты доступны для клика
                  выбранный вариант отмечен галочкой
            - do: кликнуть на вариант "Сбросить"
            - assert: |
                  попап скрылся
                  кнопка в столбце "Вердикт" поменяла название на "Выбрать"

        7. Переключение между страницами:
            - do: проскроллить страницу в самый низ
            - assert: |
                  внизу страницы есть переключатель по страницам
                  по умолчанию выбрана первая страница
                  кнопка "<" недоступна для клика
            - do: кликнуть на кнопку ">"
            - assert: |
                  таблица обновилась
                  показаны данные со второй страницы
                  выбранный номер 2 активный
            - do: кликнуть на номер последней страницы
            - assert: |
                  таблица обновилась
                  показаны данные с последней страницы
                  выбрана последняя страница
                  кнопка ">" недоступна для клика

        8. Переход по ссылке из столбца "Название":
            - do: в столбце "Название" навести на курсор на любое из названий
            - assert: появилась подсказка с адресом страницы, на которую ведёт это название
            - do: кликнуть на это название
            - assert: |
                  в соседней вкладке открылась страница 
                  адрес страницы совпал с тем, что был в подсказке

        9. Переход по ссылке из столбца "Найденная ссылка":
            - do: в столбце "Найденная ссылка" кликнуть на любую ссылку
            - assert: |
                  в соседней вкладке открылась страница 
                  адрес страницы совпал с тем, что был указан в таблице

        10. Переключение на таб "Добавлены в меморандум":
            - do: кликнуть на таб "Добавлены в меморандум"
            - screenshot: логотип, таб "Кандидаты в меморандум", выбранный таб "Добавлены в меморандум", аккаунт пользователя, строка поиска, таблица с данными, переключатель страниц [plain]
            - assert: |
                  в текущей вкладке открылась страница /memo

files: []

priority: blocker

tags:
    - reviewed
    - no_assessors
