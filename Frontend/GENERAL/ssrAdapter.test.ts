import { ssrAdapter } from './ssrAdapter';
import { Experiments } from '../../utils/experiments/Experiments';

const newMetaFormat = {
    settings: {
        // не изменялось
    },
    visibilitySettings: {
        // не изменялось
    },
    rtbAuctionInfo: {
        // не изменялось
    },
    direct: {
        directTitle: {
            title: 'реклама',
            url: 'https://direct.yandex.ru/?partner',
        },
        ads: [
            {
                direct_data: {
                    body: 'Запишись на прием врача остеопата - лечение боли в суставах, позвоночнике и спине',
                    domain: 'atmosferika.ru',
                    newImage: {},
                    mdsMetaInfo: [
                        {
                            ColorWizButton: '#C0BFC6',
                            ColorWizButtonText: '#563E4A',
                            ColorWizBackRight: '#949B9F',
                            'smart-center': {
                                y: 69,
                                h: 140,
                                x: 0,
                                w: 45,
                            },
                            'smart-centers': [
                                {
                                    y: 69,
                                    h: 140,
                                    x: 0,
                                    w: 45,
                                },
                                {
                                    y: 45,
                                    h: 252,
                                    x: 0,
                                    w: 44,
                                },
                                {
                                    y: 0,
                                    h: 339,
                                    x: 75,
                                    w: 34,
                                },
                                {
                                    y: 45,
                                    h: 155,
                                    x: 0,
                                    w: 44,
                                },
                                {
                                    y: 0,
                                    h: 339,
                                    x: 179,
                                    w: 25,
                                },
                                {
                                    y: 0,
                                    h: 336,
                                    x: 0,
                                    w: 45,
                                },
                            ],
                            ColorWizBack: '#D3D6DC',
                        },
                    ],
                    img: [
                        {
                            h: 339,
                            val: 'https://avatars.mds.yandex.net/get-direct/2398261/B8dOWL4p_wELhMoDIhm3kw/x450',
                            w: 450,
                        },
                    ],
                    title: 'Дипломированный врач остеопат',
                    faviconSizes: {
                        h: 300,
                        w: 300,
                    },
                    targetUrl: 'https://atmosferika.ru/?utm_ya_campaign=32967230642&utm_banner_type=209',
                },
                bs_data: {
                    skipPictures: true,
                    isSmartTga: false,
                    count_links: {
                        falseClick: 'count-false-1',
                        url: 'count-url',
                        sitelinks: [
                            {
                                url: '',
                                targetUrl: '',
                                title: '',
                            },
                            {
                                url: '',
                                targetUrl: '',
                                title: '',
                            },
                        ],
                        linkTail: 'tail-link',
                    },
                    pathUrl: '',
                    isInCollection: false,
                    cardIdFavorite: null,
                },
            },
            {
                direct_data: {
                    ratings: {
                        maps_rating_float: '4.2',
                        maps_reviews_count: '2',
                        maps_reviews_link: 'https://yandex.ru/maps/org/107960592090/reviews/'
                    },
                    body: 'Запишись на прием врача остеопата - лечение боли в суставах, позвоночнике и спине',
                    domain: 'atmosferika.ru',
                    newImage: {},
                    mdsMetaInfo: [
                        {
                            ColorWizButton: '#C0BFC6',
                            ColorWizButtonText: '#563E4A',
                            ColorWizBackRight: '#949B9F',
                            'smart-center': {
                                y: 69,
                                h: 140,
                                x: 0,
                                w: 45,
                            },
                            'smart-centers': [
                                {
                                    y: 69,
                                    h: 140,
                                    x: 0,
                                    w: 45,
                                },
                                {
                                    y: 45,
                                    h: 252,
                                    x: 0,
                                    w: 44,
                                },
                                {
                                    y: 0,
                                    h: 339,
                                    x: 75,
                                    w: 34,
                                },
                                {
                                    y: 45,
                                    h: 155,
                                    x: 0,
                                    w: 44,
                                },
                                {
                                    y: 0,
                                    h: 339,
                                    x: 179,
                                    w: 25,
                                },
                                {
                                    y: 0,
                                    h: 336,
                                    x: 0,
                                    w: 45,
                                },
                            ],
                            ColorWizBack: '#D3D6DC',
                        },
                    ],
                    img: [
                        {
                            h: 339,
                            val: 'https://avatars.mds.yandex.net/get-direct/2398261/B8dOWL4p_wELhMoDIhm3kw/x450',
                            w: 450,
                        },
                    ],
                    title: 'Дипломированный врач остеопат',
                    faviconSizes: {
                        h: 300,
                        w: 300,
                    },
                    targetUrl: 'https://atmosferika.ru/?utm_ya_campaign=32967230642&utm_banner_type=209',
                },
                bs_data: {
                    minDisplayNewMarketRating: '40',
                    hideExternalData: false,
                    skipPictures: false,
                    isSmartTga: false,
                    count_links: {
                        falseClick: 'count-false-2',
                        url: 'count-url',
                        sitelinks: [
                            {
                                url: '',
                                targetUrl: '',
                                title: '',
                            },
                            {
                                url: '',
                                targetUrl: '',
                                title: '',
                            },
                        ],
                        linkTail: 'tail-link',
                    },
                    pathUrl: '',
                    isInCollection: false,
                    cardIdFavorite: null,
                },
            },
            {
                body: 'Запишись на прием врача остеопата - лечение боли в суставах, позвоночнике и спине',
                domain: 'atmosferika.ru',
                faviconWidth: '300',
                faviconHeight: '300',
                title: 'Дипломированный врач остеопат',
                targetUrl: 'https://atmosferika.ru/?utm_ya_campaign=32967230642&utm_banner_type=209',
                images: [
                    [
                        'https://avatars.mds.yandex.net/get-direct/2398261/B8dOWL4p_wELhMoDIhm3kw/x450',
                        '450',
                        '339',
                        {
                            ColorWizButton: '#C0BFC6',
                            ColorWizButtonText: '#563E4A',
                            ColorWizBackRight: '#949B9F',
                            'smart-center': {
                                y: 69,
                                h: 140,
                                x: 0,
                                w: 45,
                            },
                            'smart-centers': [
                                {
                                    y: 69,
                                    h: 140,
                                    x: 0,
                                    w: 45,
                                },
                                {
                                    y: 45,
                                    h: 252,
                                    x: 0,
                                    w: 44,
                                },
                                {
                                    y: 0,
                                    h: 339,
                                    x: 75,
                                    w: 34,
                                },
                                {
                                    y: 45,
                                    h: 155,
                                    x: 0,
                                    w: 44,
                                },
                                {
                                    y: 0,
                                    h: 339,
                                    x: 179,
                                    w: 25,
                                },
                                {
                                    y: 0,
                                    h: 336,
                                    x: 0,
                                    w: 45,
                                },
                            ],
                            ColorWizBack: '#D3D6DC',
                        },
                    ],
                ],
            }
        ],
    },
    common: {
        // не изменялось
    },
    matchUrls: [
        // не изменялось
    ],
};

const expectedOldFormat = {
    settings: {
        // не изменялось
    },
    visibilitySettings: {
        // не изменялось
    },
    rtbAuctionInfo: {
        // не изменялось
    },
    direct: {
        directTitle: {
            title: 'реклама',
            url: 'https://direct.yandex.ru/?partner',
        },
        ads: [
            {
                falseClick: 'count-false-1',
                body: 'Запишись на прием врача остеопата - лечение боли в суставах, позвоночнике и спине',
                faviconWidth: '300',
                faviconHeight: '300',
                title: 'Дипломированный врач остеопат',
                targetUrl: 'https://atmosferika.ru/?utm_ya_campaign=32967230642&utm_banner_type=209',
                skipPictures: true,
                warning: '',
                age: '',
                path: '',
                secondTitle: '',
                telNum: '',
                metro: '',
                price_info: {
                    price: '',
                    currency: '',
                    prefix: '',
                    old: '',
                    discount: '',
                },
                isSmartTga: false,
                domain: 'atmosferika.ru',
                liked: '0',
                adId: 0,
                bannerFlags: '',
                blockFavicon: '0',
                region: '',
                floatMarketRating: -1,
                hitLogId: 0,
                algId: '',
                bannerCategories: [],
                eventHash: 0,
                isTurboBanner: false,
                orderTags: [],
                bannerLang: '0',
                address: '',
                workingTime: '',
                callUrl: '',
                vcardUrl: '',
                companyName: '',
                pathUrl: '',
                url: 'count-url',
                sitelinks: [
                    {
                        url: '',
                        targetUrl: '',
                        title: '',
                    },
                    {
                        url: '',
                        targetUrl: '',
                        title: '',
                    },
                ],
                linkTail: 'tail-link',
                punyDomain: 'atmosferika.ru',
                adv_type: '0',
                phraseId: 0,
                isInCollection: false,
            },
            {
                falseClick: 'count-false-2',
                ratings: {
                    maps_rating_float: '4.2',
                    maps_reviews_count: '2',
                    maps_reviews_link: 'https://yandex.ru/maps/org/107960592090/reviews/'
                },
                minDisplayNewMarketRating: '40',
                hideExternalData: false,
                body: 'Запишись на прием врача остеопата - лечение боли в суставах, позвоночнике и спине',
                faviconWidth: '300',
                faviconHeight: '300',
                title: 'Дипломированный врач остеопат',
                targetUrl: 'https://atmosferika.ru/?utm_ya_campaign=32967230642&utm_banner_type=209',
                newImage: {},
                images: [
                    [
                        'https://avatars.mds.yandex.net/get-direct/2398261/B8dOWL4p_wELhMoDIhm3kw/x450',
                        '450',
                        '339',
                        {
                            ColorWizButton: '#C0BFC6',
                            ColorWizButtonText: '#563E4A',
                            ColorWizBackRight: '#949B9F',
                            'smart-center': {
                                y: 69,
                                h: 140,
                                x: 0,
                                w: 45,
                            },
                            'smart-centers': [
                                {
                                    y: 69,
                                    h: 140,
                                    x: 0,
                                    w: 45,
                                },
                                {
                                    y: 45,
                                    h: 252,
                                    x: 0,
                                    w: 44,
                                },
                                {
                                    y: 0,
                                    h: 339,
                                    x: 75,
                                    w: 34,
                                },
                                {
                                    y: 45,
                                    h: 155,
                                    x: 0,
                                    w: 44,
                                },
                                {
                                    y: 0,
                                    h: 339,
                                    x: 179,
                                    w: 25,
                                },
                                {
                                    y: 0,
                                    h: 336,
                                    x: 0,
                                    w: 45,
                                },
                            ],
                            ColorWizBack: '#D3D6DC',
                        },
                    ],
                ],
                skipPictures: false,
                warning: '',
                age: '',
                path: '',
                secondTitle: '',
                telNum: '',
                metro: '',
                price_info: {
                    price: '',
                    currency: '',
                    prefix: '',
                    old: '',
                    discount: '',
                },
                isSmartTga: false,
                domain: 'atmosferika.ru',
                liked: '0',
                adId: 0,
                bannerFlags: '',
                blockFavicon: '0',
                region: '',
                floatMarketRating: -1,
                hitLogId: 0,
                algId: '',
                bannerCategories: [],
                eventHash: 0,
                isTurboBanner: false,
                orderTags: [],
                bannerLang: '0',
                address: '',
                workingTime: '',
                callUrl: '',
                vcardUrl: '',
                companyName: '',
                pathUrl: '',
                url: 'count-url',
                sitelinks: [
                    {
                        url: '',
                        targetUrl: '',
                        title: '',
                    },
                    {
                        url: '',
                        targetUrl: '',
                        title: '',
                    },
                ],
                linkTail: 'tail-link',
                punyDomain: 'atmosferika.ru',
                adv_type: '0',
                phraseId: 0,
                isInCollection: false,
            },
            {
                body: 'Запишись на прием врача остеопата - лечение боли в суставах, позвоночнике и спине',
                domain: 'atmosferika.ru',
                faviconWidth: '300',
                faviconHeight: '300',
                title: 'Дипломированный врач остеопат',
                targetUrl: 'https://atmosferika.ru/?utm_ya_campaign=32967230642&utm_banner_type=209',
                images: [
                    [
                        'https://avatars.mds.yandex.net/get-direct/2398261/B8dOWL4p_wELhMoDIhm3kw/x450',
                        '450',
                        '339',
                        {
                            ColorWizButton: '#C0BFC6',
                            ColorWizButtonText: '#563E4A',
                            ColorWizBackRight: '#949B9F',
                            'smart-center': {
                                y: 69,
                                h: 140,
                                x: 0,
                                w: 45,
                            },
                            'smart-centers': [
                                {
                                    y: 69,
                                    h: 140,
                                    x: 0,
                                    w: 45,
                                },
                                {
                                    y: 45,
                                    h: 252,
                                    x: 0,
                                    w: 44,
                                },
                                {
                                    y: 0,
                                    h: 339,
                                    x: 75,
                                    w: 34,
                                },
                                {
                                    y: 45,
                                    h: 155,
                                    x: 0,
                                    w: 44,
                                },
                                {
                                    y: 0,
                                    h: 339,
                                    x: 179,
                                    w: 25,
                                },
                                {
                                    y: 0,
                                    h: 336,
                                    x: 0,
                                    w: 45,
                                },
                            ],
                            ColorWizBack: '#D3D6DC',
                        },
                    ],
                ],
            }
        ],
    },
    common: {
        // не изменялось
    },
    matchUrls: [
        // не изменялось
    ],
};

describe('ssrAdapter', () => {
    it('Тест для ТГО: Первый баннер в новом формате, второй в старом', () => {
        const experiments = new Experiments({ flags: {}, flagsMap: {}, testIds: '' });
        const adaptedDate = ssrAdapter(newMetaFormat, {}, experiments, {
            isSspRtbCacheRequest: false,
            isSspFromIframeRequest: false,
            isMobileSdk: false,
            enableSsrMediaImageInMobileSdk: false,
            enableSsrMediaCreativeInMobileSdk: false,
            enableSsrMediaCreativeReachInMobileSdk: false,
        });
        const preparedMetaToOldFormat = adaptedDate.meta;
        const isAdaptedData = adaptedDate.adapted;

        expect(isAdaptedData).toEqual(true);
        expect(preparedMetaToOldFormat).toEqual(expectedOldFormat);
    });
});
