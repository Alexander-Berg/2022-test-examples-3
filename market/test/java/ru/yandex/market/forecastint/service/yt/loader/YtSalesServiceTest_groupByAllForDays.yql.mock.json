[{"hashKey":"3064a9a18f8864e341d48bad290599ab","query":"USE hahn; $formatDate = DateTime::Format(\"%Y-%m-%d\");\n\nSELECT\n    CAST(null as Int64) as msku,\n    CAST(null as Int64) as warehouse_id,\n    CAST(null as Int64) as supplier_id,\n    CAST(null as Int64) as category_id,\n    `date`,\n    sum(item_count) as sales,\n    avg(item_count) as avg_sales,\n    sum(cast(sales.item_price_rub_numeric as double)) as price,\n    avg(cast(sales.item_price_rub_numeric as double)) as avg_price\nFROM RANGE (\n`/home/market/production/mstat/analyst/regular/cubes_vertica/fact_new_order_item_dict`,\n'2021-12',\n'2021-12'\n)  with inline   as sales\nJOIN `/home/market/production/mstat/analyst/regular/cubes_vertica/fact_new_order_dict`  with inline as orders\n    ON sales.order_id = orders.id\nLEFT JOIN `/home/market/production/mstat/analyst/regular/cubes_vertica/fact_new_order_delivery`  with inline as deliveries\n    ON sales.order_id = deliveries.order_id\nLEFT JOIN `/home/market/production/mstat/dictionaries/mbo/sku_transitions/latest`  with inline as sku_transitions\n    ON sales.market_sku = sku_transitions.old_entity_id\n    LEFT JOIN `/home/market/production/mbo/export/recent/models/sku`  with inline as a\n        ON a.model_id = sales.market_sku\n    LEFT JOIN `/home/market/production/mstat/dictionaries/mbo/catteam/latest`  with inline as cm\n        ON CAST(cm.category_id AS Int64) = a.category_id\nWHERE orders.market_fulfilment_flag AND sales.warehouse_id IS NOT NULL\n    AND LENGTH(sales.real_supplier_id) > 0 AND (deliveries.shipment_datetime > '1970-01-01T00:00:00'\n    OR (orders.order_status != 'CANCELLED' AND orders.order_status != 'CANCELLED_WITHOUT_REFUND'))\n    AND DateTime::MakeDate(DateTime::ParseIso8601(orders.creation_date))\n    BETWEEN Date('2021-12-14') AND Date('2021-12-25')\n     AND COALESCE(sku_transitions.new_entity_id, sales.market_sku) in (107981) \n     AND sales.warehouse_id in (171) \n     AND sales.partner_id in (777) \n     AND a.category_id in (1) \n     AND cm.catteam in ('catteam1') \nGROUP BY\n            $formatDate(DateTime::ParseIso8601(orders.creation_date))\n    as `date`\nORDER BY `date`\n\n","data":"{\"data\":[ {\"Write\":[{\"Type\":[\"ListType\",[\"StructType\",[[\"msku\",[\"OptionalType\",[\"DataType\",\"Int64\"]]],[\"warehouse_id\",[\"OptionalType\",[\"DataType\",\"Int64\"]]],[\"supplier_id\",[\"OptionalType\",[\"DataType\",\"Int64\"]]],[\"category_id\",[\"OptionalType\",[\"DataType\",\"Int64\"]]],[\"date\",[\"OptionalType\",[\"DataType\",\"String\"]]],[\"sales\",[\"OptionalType\",[\"DataType\",\"Int64\"]]],[\"avg_sales\",[\"OptionalType\",[\"DataType\",\"Double\"]]],[\"price\",[\"OptionalType\",[\"DataType\",\"Double\"]]],[\"avg_price\",[\"OptionalType\",[\"DataType\",\"Double\"]]]]]],\"Data\":[[null,null,null,null,[\"2021-12-14\"],[\"1\"],[\"1\"],[\"650\"],[\"650\"]],[null,null,null,null,[\"2021-12-25\"],[\"3\"],[\"3\"],[\"653\"],[\"653\"]]]}],\"Position\":{\"Column\":\"1\",\"Row\":\"3\",\"File\":\"<main>\"}}],\"errors\":[],\"id\":\"61e87899d2706c7ba3774375\",\"issues\":[{\"code\":1030,\"column\":0,\"file\":\"<main>\",\"issues\":[{\"code\":0,\"column\":1,\"file\":\"<main>\",\"issues\":[{\"code\":0,\"column\":21,\"file\":\"<main>\",\"issues\":[{\"code\":0,\"column\":25,\"file\":\"<main>\",\"issues\":[{\"code\":0,\"column\":25,\"file\":\"<main>\",\"issues\":[{\"code\":0,\"column\":56,\"file\":\"<main>\",\"issues\":[{\"code\":1108,\"column\":56,\"file\":\"<main>\",\"issues\":[],\"message\":\"IN may produce unexpected result when used with nullable arguments. Consider adding 'PRAGMA AnsiInForEmptyOrNullableItemsCollections;'\",\"row\":33,\"severity\":\"S_WARNING\"}],\"message\":\"At function: SqlIn\",\"row\":33,\"severity\":\"S_WARNING\"},{\"code\":0,\"column\":16,\"file\":\"<main>\",\"issues\":[{\"code\":1108,\"column\":16,\"file\":\"<main>\",\"issues\":[],\"message\":\"IN may produce unexpected result when used with nullable arguments. Consider adding 'PRAGMA AnsiInForEmptyOrNullableItemsCollections;'\",\"row\":34,\"severity\":\"S_WARNING\"}],\"message\":\"At function: SqlIn\",\"row\":34,\"severity\":\"S_WARNING\"}],\"message\":\"At function: And\",\"row\":37,\"severity\":\"S_WARNING\"},{\"code\":0,\"column\":25,\"file\":\"<main>\",\"issues\":[{\"code\":0,\"column\":25,\"file\":\"<main>\",\"issues\":[{\"code\":0,\"column\":16,\"file\":\"<main>\",\"issues\":[{\"code\":1108,\"column\":16,\"file\":\"<main>\",\"issues\":[],\"message\":\"IN may produce unexpected result when used with nullable arguments. Consider adding 'PRAGMA AnsiInForEmptyOrNullableItemsCollections;'\",\"row\":35,\"severity\":\"S_WARNING\"}],\"message\":\"At function: SqlIn\",\"row\":35,\"severity\":\"S_WARNING\"},{\"code\":0,\"column\":12,\"file\":\"<main>\",\"issues\":[{\"code\":1108,\"column\":12,\"file\":\"<main>\",\"issues\":[],\"message\":\"IN may produce unexpected result when used with nullable arguments. Consider adding 'PRAGMA AnsiInForEmptyOrNullableItemsCollections;'\",\"row\":36,\"severity\":\"S_WARNING\"}],\"message\":\"At function: SqlIn\",\"row\":36,\"severity\":\"S_WARNING\"}],\"message\":\"At function: And\",\"row\":37,\"severity\":\"S_WARNING\"},{\"code\":0,\"column\":13,\"file\":\"<main>\",\"issues\":[{\"code\":1108,\"column\":13,\"file\":\"<main>\",\"issues\":[],\"message\":\"IN may produce unexpected result when used with nullable arguments. Consider adding 'PRAGMA AnsiInForEmptyOrNullableItemsCollections;'\",\"row\":37,\"severity\":\"S_WARNING\"}],\"message\":\"At function: SqlIn\",\"row\":37,\"severity\":\"S_WARNING\"}],\"message\":\"At function: And\",\"row\":37,\"severity\":\"S_WARNING\"}],\"message\":\"At function: And, At function: And\",\"row\":37,\"severity\":\"S_WARNING\"}],\"message\":\"At function: AssumeColumnOrderPartial, At function: Aggregate, At function: OrderedFilter, At function: Coalesce\",\"row\":17,\"severity\":\"S_WARNING\"}],\"message\":\"At function: RemovePrefixMembers, At function: Sort, At function: PersistableRepr, At function: SqlProject\",\"row\":3,\"severity\":\"S_WARNING\"}],\"message\":\"Type annotation\",\"row\":0,\"severity\":\"S_WARNING\"}],\"status\":\"COMPLETED\",\"updatedAt\":\"2022-01-19T20:47:38.248Z\",\"version\":1000000}"}]