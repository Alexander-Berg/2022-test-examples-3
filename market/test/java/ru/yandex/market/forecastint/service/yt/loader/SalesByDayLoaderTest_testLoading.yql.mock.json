[{"hashKey":"48b5d7bf73b25a3ee863351a23a44d68","query":"USE hahn; $sales = (\n    SELECT\n        COALESCE(sku_transitions.new_entity_id, sales.market_sku) as market_sku,\n        sales.warehouse_id as warehouse_id,\n        sales.partner_id as supplier_id,\n        SUBSTRING(orders.creation_date, 0, 10) as `date`,\n        item_count,\n        sales.item_price_rub_numeric as price\n    FROM RANGE (\n`/home/market/production/mstat/analyst/regular/cubes_vertica/fact_new_order_item_dict`,\n'2021-09',\n'2021-12'\n)  with inline   as sales\n        JOIN `/home/market/production/mstat/analyst/regular/cubes_vertica/fact_new_order_dict`  with inline as orders\n            ON sales.order_id = orders.id\n        LEFT JOIN `/home/market/production/mstat/analyst/regular/cubes_vertica/fact_new_order_delivery`  with inline as deliveries\n            ON sales.order_id = deliveries.order_id\n        LEFT JOIN `/home/market/production/mstat/dictionaries/mbo/sku_transitions/latest`  with inline as sku_transitions\n            ON sales.market_sku = sku_transitions.old_entity_id\n    WHERE orders.market_fulfilment_flag and LENGTH(sales.real_supplier_id) > 0 and (deliveries.shipment_datetime > '1970-01-01T00:00:00'\n        OR (orders.order_status != 'CANCELLED' and orders.order_status != 'CANCELLED_WITHOUT_REFUND'))\n        AND DateTime::MakeDate(DateTime::ParseIso8601(orders.creation_date))\n        BETWEEN Date('2021-09-30')\n            AND Date('2021-12-29')\n);\n\nSELECT\n    market_sku,\n    warehouse_id,\n    supplier_id,\n    `date`,\n    sum(item_count) as sales,\n    sum(cast(price as double)) as price\nFROM $sales\nGROUP BY market_sku, warehouse_id, supplier_id, `date`\n","data":"{\"data\":[ {\"Write\":[{\"Type\":[\"ListType\",[\"StructType\",[[\"market_sku\",[\"OptionalType\",[\"DataType\",\"Int64\"]]],[\"warehouse_id\",[\"OptionalType\",[\"DataType\",\"Int64\"]]],[\"supplier_id\",[\"OptionalType\",[\"DataType\",\"Int64\"]]],[\"date\",[\"OptionalType\",[\"DataType\",\"String\"]]],[\"sales\",[\"OptionalType\",[\"DataType\",\"Int64\"]]],[\"price\",[\"OptionalType\",[\"DataType\",\"Double\"]]]]]],\"Data\":[[[\"107981\"],[\"171\"],[\"777\"],[\"2021-12-14\"],[\"1\"],[\"650\"]],[[\"107983\"],[\"171\"],[\"777\"],[\"2021-12-16\"],[\"16\"],[\"2634\"]],[[\"107981\"],[\"171\"],[\"777\"],[\"2021-12-25\"],[\"3\"],[\"653\"]],[[\"2\"],[\"171\"],[\"777\"],[\"2021-12-28\"],[\"10\"],[\"655\"]]]}],\"Position\":{\"Column\":\"1\",\"Row\":\"27\",\"File\":\"<main>\"}}],\"errors\":[],\"id\":\"61e87f12054af0a942d0316f\",\"issues\":[],\"status\":\"COMPLETED\",\"updatedAt\":\"2022-01-19T21:14:41.926Z\",\"version\":1000000}"}]