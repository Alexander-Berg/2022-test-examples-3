[{"hashKey":"f6590dc2b0f603bf511892331e68e5be","query":"USE hahn; \n        \n        PRAGMA DisableAnsiInForEmptyOrNullableItemsCollections;\n\n        $ssku_msku_mapping = (\n            SELECT\n                IF(\n                    m.approved_sku_mapping_id > 0,\n                    m.approved_sku_mapping_id,\n                    ofs.approved_sku_mapping_id\n                ) AS msku,\n                ofs.shop_sku as shop_sku,\n                ofs.supplier_id as supplier_id,\n                s.rs_id || '.' || ofs.shop_sku AS ssku\n            FROM `/home/market/production/mbo/stat/mboc_offers/latest`  with inline AS ofs\n                JOIN `/home/market/production/mstat/dictionaries/shop_real_supplier/latest`  with inline AS s\n                    ON s.id = ofs.supplier_id\n                LEFT JOIN `/home/market/production/mbo/mboc/offer-mapping`  with inline AS m\n                    ON ofs.shop_sku = m.shop_sku and ofs.business_id = m.business_id\n            WHERE (m.approved_sku_mapping_id > 0 OR ofs.approved_sku_mapping_id > 0)\n        );\n\n        $suppliers_1p = (\n            SELECT id FROM `/home/market/production/mstat/dictionaries/shop_real_supplier/latest`  with inline\n        );\n\n        $master_data = (\n            SELECT\n                m.supplier_id   AS supplier_id,\n                m.shop_sku      AS shop_sku,\n                SOME(Yson::LookupString(\n                    m.data,\n                    'manufacturer',\n                    Yson::Options(false as Strict)\n                ))              AS name\n                FROM `/home/market/production/mstat/dictionaries/mdm/master_data/latest`  with inline AS m\n                WHERE m.supplier_id > 0\n                    AND m.supplier_id IN $suppliers_1p\n                    AND m.shop_sku IS NOT NULL\n                    AND m.shop_sku != ''\n                    AND m.data IS NOT NULL\n                GROUP BY m.supplier_id, m.shop_sku\n        );\n\n        SELECT\n            m.ssku                  AS ssku,\n            m.msku                  AS msku,\n            m.supplier_id           AS supplier_id,\n            md.name                 AS manufacturer\n        FROM $ssku_msku_mapping AS m\n            LEFT JOIN $master_data AS md\n                ON md.supplier_id = m.supplier_id AND md.shop_sku = m.shop_sku\n","data":"{\"data\":[ {\"Write\":[{\"Type\":[\"ListType\",[\"StructType\",[[\"ssku\",[\"OptionalType\",[\"DataType\",\"String\"]]],[\"msku\",[\"OptionalType\",[\"DataType\",\"Int64\"]]],[\"supplier_id\",[\"OptionalType\",[\"DataType\",\"Int64\"]]],[\"manufacturer\",[\"OptionalType\",[\"DataType\",\"String\"]]]]]],\"Data\":[[[\"004000.004000\"],[\"234\"],[\"566631\"],[\"manufacturer3\"]],[[\"004000.004001\"],[\"123\"],[\"566631\"],null],[[\"004055.004003\"],[\"234\"],[\"644283\"],[\"manufacturer2\"]],[[\"004066.004003\"],[\"235\"],[\"644282\"],[\"manufacturer1\"]]]}],\"Position\":{\"Column\":\"9\",\"Row\":\"45\",\"File\":\"<main>\"}}],\"errors\":[],\"id\":\"620694b3d2706cb6c53d329b\",\"issues\":[],\"status\":\"COMPLETED\",\"updatedAt\":\"2022-02-11T16:55:06.491Z\",\"version\":1000000}","type":"YQL_QUERY"},{"cacheKey":null,"base64Value":null,"type":"YT_DATA"}]