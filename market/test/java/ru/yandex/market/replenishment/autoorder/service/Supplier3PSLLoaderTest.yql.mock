[{"hashKey":"88abdb7a3891066a59afd156acb2fc4d","query":"USE hahn; PRAGMA yt.InferSchema = '1';\nPRAGMA AnsiInForEmptyOrNullableItemsCollections;\n\n$current_date = Date(\"2022-02-16\");\n\n$request_info = (\n    SELECT\n         supplier_id,\n         purchase_id as request_id,\n         min(requested_qty) as requested_qty,\n         MIN_OF(1.0, SUM(request_exec_quality)) as sl\n    FROM `/home/market/production/replenishment/reports/sl_3p/request_supplies`  with inline\n    WHERE\n        (cast(request_date as Date) between $current_date - Interval(\"P60D\") and $current_date - Interval(\"P1D\"))\n        and use_in_calc_sl = 1\n        and purchase_id is not null\n        and requested_qty > 0\n    GROUP BY supplier_id, purchase_id\n);\n\nSELECT\n    supplier_id,\n    SUM(sl * requested_qty) / SUM(requested_qty) as sl\nFROM $request_info\nGROUP BY supplier_id having SUM(requested_qty) > 0;\n","data":"{\"data\":[ {\"Write\":[{\"Type\":[\"ListType\",[\"StructType\",[[\"supplier_id\",[\"OptionalType\",[\"DataType\",\"Int64\"]]],[\"sl\",[\"OptionalType\",[\"DataType\",\"Double\"]]]]]],\"Data\":[[[\"111111\"],[\"0.6523809521904762\"]],[[\"222222\"],[\"0.8599999997391305\"]]]}],\"Position\":{\"Column\":\"1\",\"Row\":\"21\",\"File\":\"<main>\"}}],\"errors\":[],\"id\":\"6245ee9bbab793fe0ccb7e36\",\"issues\":[],\"status\":\"COMPLETED\",\"updatedAt\":\"2022-03-31T18:11:06.484Z\",\"version\":1000000}","type":"YQL_QUERY"},{"cacheKey":null,"base64Value":null,"type":"YT_DATA"}]