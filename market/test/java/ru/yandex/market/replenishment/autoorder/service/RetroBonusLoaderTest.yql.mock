[{"hashKey":"ff08950628b658694d7f8ab3b130cac7","query":"USE hahn; $parse_date = DateTime::Parse(\"%d.%m.%Y\");\n$extract_date = ($dateString) -> {\n    return DateTime::MakeDate($parse_date($dateString));\n};\n\nSELECT\n    agr.VendAccount as rs_id,\n    sum(RebateValue) as value\nFROM `/home/market/production/axapta_erp/BI/TAMVendRebate/RebateAgreement`  with inline as agr\n    join `/home/market/production/axapta_erp/BI/TAMVendRebate/RebateAgreementLine`  with inline as line\non agr.RecId = line.RebateAgreementRecId\nwhere WFApprovalStatus = 'Утверждено' and ItemRebateCode = 'Все' and IsForecastFactor = 1\nand $extract_date(SUBSTRING(ValidFrom, NULL, 10)) <= CurrentUtcDate()\nand ValidTo IS NOT NULL\n-- первое условие true если будущая дата дальше 2105 года\nand ($extract_date(SUBSTRING(ValidTo, NULL, 10)) IS NULL OR $extract_date(SUBSTRING(ValidTo, NULL, 10)) >= CurrentUtcDate())\ngroup by agr.VendAccount;\n","data":"{\"data\":[ {\"Write\":[{\"Type\":[\"ListType\",[\"StructType\",[[\"rs_id\",[\"OptionalType\",[\"DataType\",\"String\"]]],[\"value\",[\"OptionalType\",[\"DataType\",\"Double\"]]]]]],\"Data\":[[[\"112004\"],[\"10\"]],[[\"112005\"],[\"5.5\"]],[[\"01\"],[\"4.5\"]]]}],\"Position\":{\"Column\":\"1\",\"Row\":\"6\",\"File\":\"<main>\"}}],\"errors\":[],\"id\":\"62bc0109054af0b57905205a\",\"issues\":[],\"status\":\"COMPLETED\",\"updatedAt\":\"2022-06-29T07:37:32.290Z\",\"version\":1000000}","type":"YQL_QUERY"},{"cacheKey":null,"base64Value":null,"type":"YT_DATA"}]
