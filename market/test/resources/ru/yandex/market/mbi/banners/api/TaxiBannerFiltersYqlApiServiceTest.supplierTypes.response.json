{"yql":"USE hahn;\n\n$partner_ids = (\n    SELECT\n        id\n    FROM\n        `home/market/production/mstat/dictionaries/partner_types/latest`\n    WHERE\n        id IS NOT NULL\n);\n\n$state_b2b_partner_path = (\n    SELECT\n        max(Path)\n    FROM\n        FOLDER(`home/market/production/mstat/dwh/calculation/state_b2b_partner`)\n);\n\n$state_b2b_partner = (\n    SELECT\n        DISTINCT supplier_id AS id\n    FROM\n        CONCAT($state_b2b_partner_path)\n    WHERE\n        supplier_active_assortment_cnt = 0\n        AND supplier_id IS NOT NULL\n);\n\n$partners_with_programs = (\n    SELECT\n        partner_id\n    FROM\n        `home/market/production/mstat/dictionaries/mbi/partner_program_type/latest`\n    WHERE\n        program IN ('DROPSHIP','FULFILMENT')\n        AND partner_id IS NOT NULL\n);\n\n$express = (\n    SELECT\n        DISTINCT partner_id as id\n    FROM\n        `home/market/production/mbi/dictionaries/partner_service_link/latest`\n    WHERE\n        is_express = FALSE\n        AND partner_id IS NOT NULL\n);\n\n$business_id = (\n    SELECT\n        CAST(business_id AS Int64) as id\n    FROM\n        `home/market/production/mstat/dictionaries/partner_types/latest`\n    WHERE\n        business_id IS NOT NULL\n);\n\nSELECT\n    DISTINCT all_partners.id AS partner_id\n\nFROM $partner_ids AS all_partners\n\n    \n\n    INNER JOIN $partners_with_programs AS partners_with_choosed_programs\n        ON all_partners.id = partners_with_choosed_programs.partner_id;\n"}
