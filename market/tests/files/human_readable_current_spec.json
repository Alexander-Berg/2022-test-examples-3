{
  "spec":
    {
      "revision":1,
      "id":"tvxdphqgrtvuehof",
      "resources":
        {
          "layers":
            [
              {
                "id":"base-layer-0",
                "checksum":"EMPTY:",
                "url":"rbtorrent:29579b7e5ad9a8b64cd60818e42f4c3b164a47f1"
              },
              {
                "id":"cs-dashboard",
                "checksum":"EMPTY:",
                "url":"rbtorrent:5be326e39fbeaf20b79e2f9f49ac0446320d647b"
              },
              {
                "id":"market-common",
                "checksum":"EMPTY:",
                "url":"rbtorrent:c36e19852c0e36023999a716cfe591d8934e8b2e"
              },
              {
                "id":"logbroker_base_layer",
                "checksum":"MD5:234a033db29f2e4afae189851c0ee63d",
                "url":"rbtorrent:edd2795d2d7674eae43c4ad0de3dad563be11f94"
              },
              {
                "id":"logbroker_tools_layer",
                "meta":
                  {
                    "sandbox_resource":
                      {
                        "task_id":"678106182",
                        "resource_id":"1511170433"
                      }
                  },
                "checksum":"EMPTY:",
                "url":"rbtorrent:b39ebb6f2d6ad090e60c7e09854e4ccb5f39ca2d"
              }
            ],
          "static_resources":
            [
              {
                "id":"push_agent_config",
                "verification":
                  {
                    "checksum":"EMPTY:"
                  },
                "url":"raw:{\"port\":2222,\"mon_port\":12501,\"logbroker_host\":\"logbroker.yandex.net\",\"log_level\":7,\"credentials\":{\"tvm_client_id\":2010882,\"tvm_dst_id\":2001059,\"tvm_secret\":\"TVM_SECRET\",\"static_secret\":\"STATIC_SECRET\",\"solomon_tvm_client_id\":[2012024,2012026,2012028]},\"logs\":[{\"log_name\":\"testing_market_cs-dashboard\",\"topic\":\"deploy/mvp-test\",\"topic2\":\"deploy/logs\",\"max_disk_size_bytes\":1000000000,\"max_rotate_count\":3}]}"
              }
            ]
        },
      "volumes":
        [
          {
            "id":"logbroker_push_agent_logs_volume_id",
            "generic":
              {
              }
          },
          {
            "id":"logbroker_push_agent_porto_logs_volume_id",
            "generic":
              {
              }
          }
        ],
      "workloads":
        [
          {
            "id":"nginx",
            "box_ref":"cs-dashboard-box",
            "env":
              [
                {
                  "name":"DEPLOY_LOGS_DEFAULT_NAME",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"testing_market_cs-dashboard"
                        }
                    }
                },
                {
                  "name":"DEPLOY_LOGS_ENDPOINT",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"localhost:2222"
                        }
                    }
                },
                {
                  "name":"DEPLOY_LOGS_SECRET",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"STATIC_SECRET"
                        }
                    }
                },
                {
                  "name":"DEPLOY_WORKLOAD_ID",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"nginx"
                        }
                    }
                }
              ],
            "init":
              [
                {
                  "command_line":"/bin/prepare_nginx.sh",
                  "user":"root",
                  "group":"root"
                }
              ],
            "start":
              {
                "command_line":"/usr/sbin/nginx -p /etc/nginx -c /etc/nginx/nginx.conf",
                "user":"root",
                "group":"root",
                "stdout_file":"/porto_log_files/nginx_stdout.portolog",
                "stderr_file":"/porto_log_files/nginx_stderr.portolog"
              },
            "readiness_check":
              {
                "http_get":
                  {
                    "port":80,
                    "path":"/ping",
                    "expected_answer":"0;OK"
                  }
              },
            "transmit_logs":true
          },
          {
            "id":"cs-dashboard-box",
            "box_ref":"cs-dashboard-box",
            "env":
              [
                {
                  "name":"PWD",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"/"
                        }
                    }
                },
                {
                  "name":"SEC_ARCADIA",
                  "value":
                    {
                      "secret_env":
                        {
                          "alias":"sec-blabla:ver-blabla",
                          "id":"SEC_ARCADIA"
                        }
                    }
                },
                {
                  "name":"SEC_CALENDAR_HADOOP_TOKEN",
                  "value":
                    {
                      "secret_env":
                        {
                          "alias":"sec-bla:ver-bla",
                          "id":"SEC_CALENDAR_HADOOP_TOKEN"
                        }
                    }
                },
                {
                  "name":"SEC_CALENDAR_INC_TOKEN",
                  "value":
                    {
                      "secret_env":
                        {
                          "alias":"sec-bla:ver-bla",
                          "id":"SEC_CALENDAR_INC_TOKEN"
                        }
                    }
                },
                {
                  "name":"SEC_CALENDAR_OPS_TOKEN",
                  "value":
                    {
                      "secret_env":
                        {
                          "alias":"sec-bla:ver-bla",
                          "id":"SEC_CALENDAR_OPS_TOKEN"
                        }
                    }
                },
                {
                  "name":"SEC_CALENDAR_YT_TOKEN",
                  "value":
                    {
                      "secret_env":
                        {
                          "alias":"sec-01ecwf41r3fzeqph3v1z92tpyv:ver-01ecwf41syzxdce6vn2pz46k2x",
                          "id":"SEC_CALENDAR_YT_TOKEN"
                        }
                    }
                },
                {
                  "name":"SEC_CONDUCTOR",
                  "value":
                    {
                      "secret_env":
                        {
                          "alias":"sec-01ecwf41r3fzeqph3v1z92tpyv:ver-01ecwf41syzxdce6vn2pz46k2x",
                          "id":"SEC_CONDUCTOR"
                        }
                    }
                },
                {
                  "name":"SEC_GITHUB",
                  "value":
                    {
                      "secret_env":
                        {
                          "alias":"sec-01ecwf41r3fzeqph3v1z92tpyv:ver-01ecwf41syzxdce6vn2pz46k2x",
                          "id":"SEC_GITHUB"
                        }
                    }
                },
                {
                  "name":"SEC_IDM",
                  "value":
                    {
                      "secret_env":
                        {
                          "alias":"sec-01ecwf41r3fzeqph3v1z92tpyv:ver-01ecwf41syzxdce6vn2pz46k2x",
                          "id":"SEC_IDM"
                        }
                    }
                },
                {
                  "name":"SEC_PUNCHER",
                  "value":
                    {
                      "secret_env":
                        {
                          "alias":"sec-01ecwf41r3fzeqph3v1z92tpyv:ver-01ecwf41syzxdce6vn2pz46k2x",
                          "id":"SEC_PUNCHER"
                        }
                    }
                },
                {
                  "name":"SEC_STARTREK",
                  "value":
                    {
                      "secret_env":
                        {
                          "alias":"sec-01ecwf41r3fzeqph3v1z92tpyv:ver-01ecwf41syzxdce6vn2pz46k2x",
                          "id":"SEC_STARTREK"
                        }
                    }
                },
                {
                  "name":"DEPLOY_LOGS_DEFAULT_NAME",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"testing_market_cs-dashboard"
                        }
                    }
                },
                {
                  "name":"DEPLOY_LOGS_ENDPOINT",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"localhost:2222"
                        }
                    }
                },
                {
                  "name":"DEPLOY_LOGS_SECRET",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"STATIC_SECRET"
                        }
                    }
                },
                {
                  "name":"DEPLOY_WORKLOAD_ID",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"cs-dashboard-box"
                        }
                    }
                }
              ],
            "init":
              [
                {
                  "command_line":"/bin/prepare_app.sh",
                  "user":"root",
                  "group":"root"
                }
              ],
            "start":
              {
                "command_line":"/app/cs-dashboard -c /app/conf/cs-dashboard.conf",
                "user":"root",
                "group":"root",
                "stdout_file":"/porto_log_files/cs-dashboard-box_stdout.portolog",
                "stderr_file":"/porto_log_files/cs-dashboard-box_stderr.portolog"
              },
            "readiness_check":
              {
                "http_get":
                  {
                    "port":8080,
                    "path":"/ping",
                    "expected_answer":"0;OK"
                  }
              },
            "transmit_logs":true
          },
          {
            "id":"logbroker_push_agent_workload",
            "box_ref":"logbroker_tools_box",
            "env":
              [
                {
                  "name":"TVM_SECRET",
                  "value":
                    {
                      "secret_env":
                        {
                          "alias":"push_agent",
                          "id":"push_agent_tvm_secret"
                        }
                    }
                },
                {
                  "name":"DEPLOY_STAGE",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"testing_market_cs-dashboard"
                        }
                    }
                },
                {
                  "name":"DEPLOY_DEPLOY_UNIT",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"sas"
                        }
                    }
                },
                {
                  "name":"DEPLOY_PROJECT",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"market-sre"
                        }
                    }
                },
                {
                  "name":"STATIC_SECRET",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"STATIC_SECRET"
                        }
                    }
                }
              ],
            "ulimit_soft":
              [
                {
                  "name":1,
                  "value":805306368
                }
              ],
            "init":
              [
                {
                  "command_line":"bash -c 'rm push-agent/internal/config.json; cp static_data/raw_file push-agent/internal/config.json'",
                  "time_limit":
                    {
                      "max_restart_period_ms":10000,
                      "min_restart_period_ms":10000,
                      "max_execution_time_ms":15000
                    }
                }
              ],
            "start":
              {
                "command_line":"/push-agent/hooks/agent-start",
                "core_command":"cp --sparse=always /dev/stdin /coredumps/${CORE_EXE_NAME}.core",
                "stdout_file":"/unified-agent/logs/logbroker_push_agent_workload_stdout.portolog",
                "stderr_file":"/unified-agent/logs/logbroker_push_agent_workload_stderr.portolog",
                "stdout_and_stderr_limit":104857600
              },
            "readiness_check":
              {
                "http_get":
                  {
                    "port":12502,
                    "path":"/ready",
                    "expected_answer":"OK",
                    "time_limit":
                      {
                        "max_restart_period_ms":10000,
                        "min_restart_period_ms":10000,
                        "max_execution_time_ms":15000
                      }
                  }
              },
            "liveness_check":
              {
                "http_get":
                  {
                    "port":12502,
                    "path":"/status",
                    "any":true,
                    "time_limit":
                      {
                        "initial_delay_ms":150000,
                        "max_restart_period_ms":30000,
                        "min_restart_period_ms":30000,
                        "max_execution_time_ms":15000
                      }
                  }
              },
            "stop_policy":
              {
                "container":
                  {
                    "command_line":"/push-agent/hooks/agent-stop",
                    "time_limit":
                      {
                        "max_restart_period_ms":10000,
                        "min_restart_period_ms":10000,
                        "max_execution_time_ms":15000
                      }
                  },
                "max_tries":3
              },
            "destroy_policy":
              {
                "container":
                  {
                    "command_line":"/push-agent/hooks/agent-destroy",
                    "time_limit":
                      {
                        "max_restart_period_ms":10000,
                        "min_restart_period_ms":10000,
                        "max_execution_time_ms":15000
                      }
                  },
                "max_tries":3
              }
          },
          {
            "id":"logbroker_monitor_workload",
            "box_ref":"logbroker_tools_box",
            "start":
              {
                "command_line":"/push-agent/hooks/monitor-start"
              },
            "readiness_check":
              {
                "http_get":
                  {
                    "port":12503,
                    "path":"/ready",
                    "expected_answer":"OK",
                    "time_limit":
                      {
                        "max_restart_period_ms":10000,
                        "min_restart_period_ms":10000,
                        "max_execution_time_ms":15000
                      }
                  }
              },
            "liveness_check":
              {
                "http_get":
                  {
                    "port":12503,
                    "path":"/alive",
                    "expected_answer":"OK",
                    "time_limit":
                      {
                        "initial_delay_ms":150000,
                        "max_restart_period_ms":30000,
                        "min_restart_period_ms":30000,
                        "max_execution_time_ms":15000
                      }
                  }
              },
            "stop_policy":
              {
                "container":
                  {
                    "command_line":"/push-agent/hooks/monitor-stop",
                    "time_limit":
                      {
                        "max_restart_period_ms":10000,
                        "min_restart_period_ms":10000,
                        "max_execution_time_ms":15000
                      }
                  },
                "max_tries":3
              },
            "destroy_policy":
              {
                "container":
                  {
                    "command_line":"/push-agent/hooks/monitor-destroy",
                    "time_limit":
                      {
                        "max_restart_period_ms":10000,
                        "min_restart_period_ms":10000,
                        "max_execution_time_ms":15000
                      }
                  },
                "max_tries":3
              }
          }
        ],
      "boxes":
        [
          {
            "id":"cs-dashboard-box",
            "rootfs":
              {
                "layer_refs":
                  [
                    "base-layer-0",
                    "cs-dashboard",
                    "market-common"
                  ]
              },
            "volumes":
              [
                {
                  "volume_ref":"logbroker_push_agent_porto_logs_volume_id",
                  "mount_point":"/porto_log_files",
                  "mode":1
                }
              ],
            "compute_resources":
              {
                "thread_limit":9750
              },
            "env":
              [
                {
                  "name":"DEPLOY_BOX_ID",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"cs-dashboard-box"
                        }
                    }
                },
                {
                  "name":"DEPLOY_UNIT_ID",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"sas"
                        }
                    }
                },
                {
                  "name":"DEPLOY_STAGE_ID",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"testing_market_cs-dashboard"
                        }
                    }
                },
                {
                  "name":"DEPLOY_PROJECT_ID",
                  "value":
                    {
                      "literal_env":
                        {
                          "value":"market-sre"
                        }
                    }
                }
              ],
            "specific_type":"default"
          },
          {
            "id":"logbroker_tools_box",
            "rootfs":
              {
                "layer_refs":
                  [
                    "logbroker_base_layer",
                    "logbroker_tools_layer"
                  ]
              },
            "volumes":
              [
                {
                  "volume_ref":"logbroker_push_agent_logs_volume_id",
                  "mount_point":"/unified-agent/logs",
                  "mode":1
                }
              ],
            "static_resources":
              [
                {
                  "resource_ref":"push_agent_config",
                  "mount_point":"static_data"
                }
              ],
            "compute_resources":
              {
                "vcpu_guarantee":400,
                "vcpu_limit":400,
                "memory_guarantee":536870912,
                "memory_limit":536870912,
                "anonymous_memory_limit":536870912,
                "thread_limit":150
              },
            "specific_type":"system"
          }
        ],
      "mutable_workloads":
        [
          {
            "workload_ref":"nginx"
          },
          {
            "workload_ref":"cs-dashboard-box"
          },
          {
            "workload_ref":"logbroker_push_agent_workload"
          },
          {
            "workload_ref":"logbroker_monitor_workload"
          }
        ]
    },
  "resource_cache_spec":
    {
    },
  "resource_requests":
    {
      "vcpu_guarantee":900,
      "vcpu_limit":900,
      "memory_guarantee":3758096384,
      "memory_limit":3758096384,
      "slot":1
    },
  "ip6_address_allocations":
    [
      {
        "address":"2a02:6b8:c08:c329:10b:11e5:e158:0",
        "vlan_id":"backbone",
        "labels":
          {
          },
        "persistent_fqdn":"tvxdphqgrtvuehof.sas.yp-c.yandex.net",
        "transient_fqdn":"sas3-9016-1.tvxdphqgrtvuehof.sas.yp-c.yandex.net"
      },
      {
        "address":"2a02:6b8:fc00:c0a9:10b:11e5:2aaa:0",
        "vlan_id":"fastbone",
        "labels":
          {
          },
        "persistent_fqdn":"fb-tvxdphqgrtvuehof.sas.yp-c.yandex.net",
        "transient_fqdn":"fb-sas3-9016-1.tvxdphqgrtvuehof.sas.yp-c.yandex.net"
      }
    ],
  "ip6_subnet_allocations":
    [
      {
        "subnet":"2a02:6b8:c08:c329:10b:11e5:7713:0/112",
        "vlan_id":"backbone",
        "labels":
          {
            "attributes":
              [
                {
                  "key":"id",
                  "value":"\u0001\u0018boxes_subnet"
                }
              ]
          }
      }
    ],
  "dns":
    {
      "persistent_fqdn":"tvxdphqgrtvuehof.sas.yp-c.yandex.net",
      "transient_fqdn":"sas3-9016-1.tvxdphqgrtvuehof.sas.yp-c.yandex.net"
    },
  "secrets":
    [
      {
        "id":"push_agent",
        "payload":
          [
            {
              "key":"push_agent_static_secret",
              "value":"STATIC_SECRET"
            },
            {
              "key":"push_agent_tvm_secret",
              "value":"1XxXdhrSwI05CExoR_8SNg"
            }
          ]
      },
      {
        "id":"sec-01ecwf41r3fzeqph3v1z92tpyv:ver-01ecwf41syzxdce6vn2pz46k2x",
        "payload":
          [
            {
              "key":"SEC_CALENDAR_OPS_TOKEN",
              "value":"blabla"
            },
            {
              "key":"SEC_CALENDAR_INC_TOKEN",
              "value":"blabla"
            },
            {
              "key":"SEC_GITHUB",
              "value":"blabla"
            },
            {
              "key":"SEC_CALENDAR_HADOOP_TOKEN",
              "value":"blabla"
            },
            {
              "key":"SEC_CALENDAR_YT_TOKEN",
              "value":"blabla"
            },
            {
              "key":"SEC_PUNCHER",
              "value":"blabla"
            },
            {
              "key":"SEC_IDM",
              "value":"blabla"
            },
            {
              "key":"SEC_STARTREK",
              "value":"blabla"
            },
            {
              "key":"SEC_CONDUCTOR",
              "value":"blabla"
            },
            {
              "key":"SEC_ARCADIA",
              "value":"blabla"
            }
          ]
      }
    ],
  "pod_dynamic_attributes":
    {
      "labels":
        {
          "attributes":
            [
              {
                "key":"deploy",
                "value":"{\u0001\u001Cdeploy_unit_id=\u0001\u0006sas;\u0001\blogs={\u0001\u001Edefault_logname=\u00016testing_market_cs-dashboard;\u0001 delivery_enabled=\u0005;\u00014delivery_tvm_dst_client_id=\u0001\u000E2010882;\u0001\u001Alogs_endpoint=\u0001\u001Clocalhost:2222;};\u0001\u0014project_id=\u0001\u0014market-sre;\u0001\u0010stage_id=\u00016testing_market_cs-dashboard;}"
              },
              {
                "key":"deploy_engine",
                "value":"\u0001\nMCRSC"
              }
            ]
        }
    },
  "spec_timestamp":1715476438074792649,
  "node_entry":
    {
      "cpu":
        {
          "total_capacity":30100,
          "cpu_to_vcpu_factor":1
        }
    },
  "immutable_meta":
    {
      "node_meta":
        {
          "fqdn":"sas3-9016.search.yandex.net",
          "cluster":"sas.yp.yandex.net",
          "dc":"sas"
        },
      "pod_id":"tvxdphqgrtvuehof",
      "gpu_manager_meta":
        {
        }
    }
}
