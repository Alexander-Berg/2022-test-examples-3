package clients

import (
	"encoding/json"
	"github.com/stretchr/testify/require"
	"testing"
)

const CartResponseWithoutChanges = "{\"buyerCurrency\":\"RUR\",\"carts\":[{\"shopId\":431782,\"archived\":false,\"buyerCurrency\":\"RUR\",\"exchangeRate\":1,\"itemsTotal\":179,\"buyerItemsTotal\":179,\"total\":179,\"buyerTotal\":179,\"feeTotal\":0,\"items\":[{\"feedId\":475690,\"offerId\":\"537372.000533.8050065\",\"categoryId\":16044416,\"offerName\":\"Кофе молотый в растворимом Jacobs Monarch Millicano, пакет, 75 г\",\"count\":1,\"delivery\":true,\"modelId\":158326738,\"buyerPrice\":179,\"fee\":0,\"feeInt\":0,\"feeSum\":0,\"showInfo\":\"OTNDnItfwROQypMce5YPJwqAiI3DZ91lmeHjx7cEWPdqn2dyNjQY2S2GxiSWLw2HYsao61bsICF4F0xMDjdseIW7-Y5M9yfJZUxeCakYFwJKmXqoQcytewDpdmdZRxxO\",\"shopUrl\":\"https://pokupki.market.yandex.ru/product/100411273771?offerid=zfhdvFs0XZOR0LiD3dl_pQ\",\"vendorId\":10715744,\"sku\":\"100411273771\",\"shopSku\":\"000533.8050065\",\"specs.internal\":[],\"loyaltyProgramPartner\":true,\"buyerPriceBeforeDiscount\":259,\"buyerPriceNominal\":179,\"buyerDiscount\":80,\"categoryFullName\":\"Растворимый кофе\",\"preorder\":false,\"supplierType\":\"FIRST_PARTY\",\"itemDescriptionEnglish\":\"\",\"supplierDescription\":\"Jacobs Monarch Millicano - это кофе нового поколения \\\"молотый в растворимом\\\". Новый Jacobs Monarch Millicano соединил в себе все лучшее от растворимого и натурального молотого кофе - плотный насыщенный вкус, богатый аромат и быстроту приготовления. Благодаря специальной технологии производства каждая растворимая гранула Millicano содержит в себе частички цельных обжаренных зерен ультратонкого помола, которые отчетливо раскрывают характер кофейного зерна в каждой чашке.  Характеристки\\nТип    Кофе растворимый\\nВид кофе   Черный\\nСостав кофе 100% кофе\\nСтепень обжарки    Средняя\\nСтепень помола   Грубый\\nВес   900 г\\nСтрана происхождения Колумбия, Бразилия\\nВид упаковки   Пакет\\nУсловия хранения   В сухом прохладном месте\\nСрок годности   24 мес.\\nСтрана-изготовитель   Россия\",\"manufacturerCountries\":[{\"id\":225,\"name\":\"Россия\",\"lingua\":{\"name\":{\"genitive\":\"России\",\"preposition\":\"в\",\"prepositional\":\"России\"}}}],\"supplierWorkSchedule\":\"Пн-Вс: 00:00-24:00\",\"atSupplierWarehouse\":false,\"supplierCurrency\":\"RUR\",\"msku\":100411273771,\"warehouseId\":147,\"fulfilmentWarehouseId\":147,\"bnpl\":false,\"services\":[]}],\"fake\":false,\"deliveryOptions\":[{\"id\":\"QfbKwehV0j0NnQGEm5KGGZkzrpTGep08mcBXNcBYCH6afYJqpNkFCGCT9KyLCFUlyqxM8AzfprCk77WWM9IWxJDGGbtM0CozZWxG/a9zpih0U0WiUEdJ1A==\",\"hash\":\"QfbKwehV0j0NnQGEm5KGGZkzrpTGep08mcBXNcBYCH6afYJqpNkFCGCT9KyLCFUlyqxM8AzfprCk77WWM9IWxJDGGbtM0CozZWxG/a9zpih0U0WiUEdJ1A==\",\"deliveryOptionId\":\"431782_PICKUP_Самовывоз_11-09-2021_noreserve_11-09-2021_null_1128_107_YANDEX_MARKET_10000022432\",\"type\":\"PICKUP\",\"serviceName\":\"Самовывоз\",\"price\":49,\"buyerPrice\":49,\"dates\":{\"fromDate\":\"11-09-2021\",\"toDate\":\"11-09-2021\"},\"deliveryIntervals\":[],\"outlets\":[{\"id\":10000022432,\"regionId\":0},{\"id\":10000022434,\"regionId\":0}],\"paymentOptions\":[{\"paymentMethod\":\"CASH_ON_DELIVERY\",\"deliveryPrice\":49,\"paymentType\":\"POSTPAID\"},{\"paymentMethod\":\"APPLE_PAY\",\"deliveryPrice\":49,\"paymentType\":\"PREPAID\"},{\"paymentMethod\":\"GOOGLE_PAY\",\"deliveryPrice\":49,\"paymentType\":\"PREPAID\"},{\"paymentMethod\":\"YANDEX\",\"deliveryPrice\":49,\"paymentType\":\"PREPAID\"}],\"hiddenPaymentOptions\":[],\"validFeatures\":[\"PLAINCPA\"],\"deliveryServiceId\":107,\"deliveryPartnerType\":\"YANDEX_MARKET\",\"marketBranded\":false,\"buyerPriceBeforeDiscount\":49,\"outletTimeIntervals\":[]}],\"noAuth\":false,\"acceptMethod\":\"WEB_INTERFACE\",\"shopName\":\"Яндекс.Маркет\",\"displayOrderId\":\"null\",\"global\":false,\"removedByRegroupingItems\":[],\"bnpl\":false,\"servicesTotal\":0,\"parcelInfo\":\"w:0.09;p:179;pc:RUR;tp:179;tpc:RUR;d:6.2x14.7x19.3;ct:320/410/750/780;offers:zfhdvFs0XZOR0LiD3dl_pQ=1|w=0.09|p=179|d=6.2x14.7x19.3|wh=147|ffwh=147|ct=320/410/750/780|ff=0|fixed=0|no_replace=0;wh:147;ffwh:147;\",\"buyerTotalBeforeDiscount\":259,\"buyerItemsTotalBeforeDiscount\":259,\"buyerItemsTotalDiscount\":80,\"buyerTotalDiscount\":80,\"preorder\":false}],\"costLimitInformation\":{\"minCost\":0,\"remainingBeforeCheckout\":0,\"errors\":[]},\"buyer\":{\"uid\":0,\"assessor\":false,\"beenCalled\":false,\"yandexEmployee\":false},\"paymentOptions\":[{\"paymentType\":\"POSTPAID\",\"paymentMethod\":\"CASH_ON_DELIVERY\"}]}"
const CartResponseWithChanges = "{\"buyerCurrency\":\"RUR\",\"carts\":[{\"shopId\":431782,\"archived\":false,\"buyerCurrency\":\"RUR\",\"exchangeRate\":1,\"itemsTotal\":179,\"buyerItemsTotal\":179,\"total\":179,\"buyerTotal\":179,\"feeTotal\":0,\"items\":[{\"feedId\":475690,\"offerId\":\"537372.000533.8050065\",\"changes\":[\"PRICE\"],\"categoryId\":16044416,\"offerName\":\"Кофе молотый в растворимом Jacobs Monarch Millicano, пакет, 75 г\",\"count\":1,\"delivery\":true,\"modelId\":158326738,\"buyerPrice\":179,\"fee\":0,\"feeInt\":0,\"feeSum\":0,\"showInfo\":\"OTNDnItfwROQypMce5YPJwqAiI3DZ91lmeHjx7cEWPdqn2dyNjQY2S2GxiSWLw2HYsao61bsICF4F0xMDjdseIW7-Y5M9yfJZUxeCakYFwJKmXqoQcytewDpdmdZRxxO\",\"shopUrl\":\"https://pokupki.market.yandex.ru/product/100411273771?offerid=zfhdvFs0XZOR0LiD3dl_pQ\",\"vendorId\":10715744,\"sku\":\"100411273771\",\"shopSku\":\"000533.8050065\",\"specs.internal\":[],\"loyaltyProgramPartner\":true,\"buyerPriceBeforeDiscount\":259,\"buyerPriceNominal\":179,\"buyerDiscount\":80,\"categoryFullName\":\"Растворимый кофе\",\"preorder\":false,\"supplierType\":\"FIRST_PARTY\",\"itemDescriptionEnglish\":\"\",\"supplierDescription\":\"Jacobs Monarch Millicano - это кофе нового поколения \\\"молотый в растворимом\\\". Новый Jacobs Monarch Millicano соединил в себе все лучшее от растворимого и натурального молотого кофе - плотный насыщенный вкус, богатый аромат и быстроту приготовления. Благодаря специальной технологии производства каждая растворимая гранула Millicano содержит в себе частички цельных обжаренных зерен ультратонкого помола, которые отчетливо раскрывают характер кофейного зерна в каждой чашке.  Характеристки\\nТип    Кофе растворимый\\nВид кофе   Черный\\nСостав кофе 100% кофе\\nСтепень обжарки    Средняя\\nСтепень помола   Грубый\\nВес   900 г\\nСтрана происхождения Колумбия, Бразилия\\nВид упаковки   Пакет\\nУсловия хранения   В сухом прохладном месте\\nСрок годности   24 мес.\\nСтрана-изготовитель   Россия\",\"manufacturerCountries\":[{\"id\":225,\"name\":\"Россия\",\"lingua\":{\"name\":{\"genitive\":\"России\",\"preposition\":\"в\",\"prepositional\":\"России\"}}}],\"supplierWorkSchedule\":\"Пн-Вс: 00:00-24:00\",\"atSupplierWarehouse\":false,\"supplierCurrency\":\"RUR\",\"msku\":100411273771,\"warehouseId\":147,\"fulfilmentWarehouseId\":147,\"bnpl\":false,\"services\":[]}],\"fake\":false,\"deliveryOptions\":[{\"id\":\"QfbKwehV0j0NnQGEm5KGGZkzrpTGep08mcBXNcBYCH6afYJqpNkFCGCT9KyLCFUlyqxM8AzfprCk77WWM9IWxJDGGbtM0CozZWxG/a9zpih0U0WiUEdJ1A==\",\"hash\":\"QfbKwehV0j0NnQGEm5KGGZkzrpTGep08mcBXNcBYCH6afYJqpNkFCGCT9KyLCFUlyqxM8AzfprCk77WWM9IWxJDGGbtM0CozZWxG/a9zpih0U0WiUEdJ1A==\",\"deliveryOptionId\":\"431782_PICKUP_Самовывоз_11-09-2021_noreserve_11-09-2021_null_1128_107_YANDEX_MARKET_10000022432\",\"type\":\"PICKUP\",\"serviceName\":\"Самовывоз\",\"price\":49,\"buyerPrice\":49,\"dates\":{\"fromDate\":\"11-09-2021\",\"toDate\":\"11-09-2021\"},\"deliveryIntervals\":[],\"outlets\":[{\"id\":10000022432,\"regionId\":0},{\"id\":10000022434,\"regionId\":0}],\"paymentOptions\":[{\"paymentMethod\":\"CASH_ON_DELIVERY\",\"deliveryPrice\":49,\"paymentType\":\"POSTPAID\"},{\"paymentMethod\":\"APPLE_PAY\",\"deliveryPrice\":49,\"paymentType\":\"PREPAID\"},{\"paymentMethod\":\"GOOGLE_PAY\",\"deliveryPrice\":49,\"paymentType\":\"PREPAID\"},{\"paymentMethod\":\"YANDEX\",\"deliveryPrice\":49,\"paymentType\":\"PREPAID\"}],\"hiddenPaymentOptions\":[],\"validFeatures\":[\"PLAINCPA\"],\"deliveryServiceId\":107,\"deliveryPartnerType\":\"YANDEX_MARKET\",\"marketBranded\":false,\"buyerPriceBeforeDiscount\":49,\"outletTimeIntervals\":[]}],\"noAuth\":false,\"acceptMethod\":\"WEB_INTERFACE\",\"shopName\":\"Яндекс.Маркет\",\"displayOrderId\":\"null\",\"global\":false,\"removedByRegroupingItems\":[],\"bnpl\":false,\"servicesTotal\":0,\"parcelInfo\":\"w:0.09;p:179;pc:RUR;tp:179;tpc:RUR;d:6.2x14.7x19.3;ct:320/410/750/780;offers:zfhdvFs0XZOR0LiD3dl_pQ=1|w=0.09|p=179|d=6.2x14.7x19.3|wh=147|ffwh=147|ct=320/410/750/780|ff=0|fixed=0|no_replace=0;wh:147;ffwh:147;\",\"buyerTotalBeforeDiscount\":259,\"buyerItemsTotalBeforeDiscount\":259,\"buyerItemsTotalDiscount\":80,\"buyerTotalDiscount\":80,\"preorder\":false}],\"costLimitInformation\":{\"minCost\":0,\"remainingBeforeCheckout\":0,\"errors\":[]},\"buyer\":{\"uid\":0,\"assessor\":false,\"beenCalled\":false,\"yandexEmployee\":false},\"paymentOptions\":[{\"paymentType\":\"POSTPAID\",\"paymentMethod\":\"CASH_ON_DELIVERY\"}]}"

func TestCartResponseWithoutChanges(t *testing.T) {
	result := &CartRootResponse{}

	err := json.Unmarshal([]byte(CartResponseWithoutChanges), result)
	if err != nil {
		panic(err)
	}

	require.Equal(t, "537372.000533.8050065", result.Cart[0].CartItems[0].OfferID)
	require.Empty(t, result.Cart[0].CartItems[0].Changes)
}

func TestCartResponseWithChanges(t *testing.T) {
	result := &CartRootResponse{}
	err := json.Unmarshal([]byte(CartResponseWithChanges), result)
	if err != nil {
		panic(err)
	}

	require.Equal(t, "537372.000533.8050065", result.Cart[0].CartItems[0].OfferID)
	require.Equal(t, []string{PRICE}, result.Cart[0].CartItems[0].Changes)
}
